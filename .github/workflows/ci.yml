name: CI Pipeline

on:
    push:
        branches:
            - main
    pull_request:
        branches:
            - main

jobs:
    build-and-test:
        runs-on: ubuntu-latest

        steps:
        - name: Checkout code
          uses: actions/checkout@v4

        - name: Install Rust
          uses: actions-rs/toolchain@v1
          with:
            toolchain: stable
            override: true

        - name: Install Node.js
          uses: actions/setup-node@v4
          with:
            node-version: '20'

        - name: Install Yarn
          run: npm install -g yarn

        - name: Install project dependencies
          run: yarn install

        - name: Install Anchor
          run: |
            curl -sSf https://release.anchor.so/install.sh | sh
            echo "$HOME/.cargo/bin" >> GITHUB_PATH

        - name: Run check (Validator + Lint + Prettier + Clippy + Tests)
          run: yarn run check